# Microsoft Annual Report Retrieval with Query Expectation

This project implements a system to read data from Microsoft's annual report, generate multiple queries using LLM, and perform retrieval operations. By using the Query Expectation algorithm, the project reads files, generates multiple queries with an LLM, and then combines these queries to observe how the results differ compared to a naive single-query RAG approach.

## Contents

- [Introduction](#introduction)
- [Technologies Used](#technologies-used)
- [Project Steps](#project-steps)
- [Query Expansion (Query Expectation)](#query-expansion-query-expectation)
- [Single Query vs. Multiple Query Experience](#single-query-vs-multiple-query-experience)
- [Visualization of Results](#visualization-of-results)
- [Usage Instructions](#usage-instructions)
- [Installation](#installation)

## Introduction

This project is designed to analyze Microsoft's annual report and provide quick, accurate answers to specific financial metrics (e.g., "What was the total revenue for the year?"). It involves reading text data, splitting the text, generating embeddings, and performing retrieval operations.

## Technologies Used

- **Python**: Main programming language
- **pypdf**: For reading PDF files and extracting text
- **LangChain**: For text splitting and management
- **OpenAI API**: For query expansion using GPT-3.5 Turbo
- **Chromadb**: For creating a vector database and performing queries
- **UMAP**: For projecting high-dimensional embeddings into 2D space
- **Matplotlib**: For visualizing results

## Project Steps

1. **File Reading and Text Extraction**:
   - The Microsoft annual report PDF is read using the `pypdf` library.
   - Text is extracted from each page of the PDF and cleaned.

2. **Text Splitting**:
   - The text is split into manageable chunks using **RecursiveCharacterTextSplitter**.
   - Additionally, **SentenceTransformersTokenTextSplitter** is used to further split the text based on tokens.

3. **Embedding Creation and Vector Database**:
   - Each text chunk is embedded using the `SentenceTransformerEmbeddingFunction`.
   - The resulting embeddings are stored in a collection using `chromadb`.

4. **Query Expectation & Query Expansion**:
   - Initially, a single query was used to perform the retrieval operation.
   - Later, using OpenAI's GPT-3.5 Turbo model, additional queries related to the original query were generated.
   - The original query and the generated additional queries were combined to perform the retrieval operation.
   - This method provided more comprehensive and diverse results compared to the naive single-query approach and helped me better understand RAG concepts.

## Query Expansion (Query Expectation)

The project goes beyond classical retrieval by applying a query expansion strategy. With the help of an LLM (GPT-3.5 Turbo), similar or related queries are generated based on the original query. This approach offers several benefits:
- Users can explore different aspects of the topic rather than relying on a single query.
- It provides richer and more varied retrieval results compared to a naive RAG approach.
- Combining multiple queries increases the coverage and accuracy of the retrieval process.

## Single Query vs. Multiple Query Experience

- **Single Query**: Initially, the retrieval was performed using only a single query. This approach produced a narrower set of results.
- **Multiple Query**: Later, additional queries generated by the LLM were used alongside the original query. This method produced a wider and more diverse set of results. The experience demonstrated that using multiple queries not only diversified the retrieval results but also deepened my understanding of RAG (Retrieval-Augmented Generation) concepts.

## Visualization of Results

- **Gray Dots**: All text chunk embeddings from the dataset
- **Orange X's**: Embeddings of the expanded queries
- **Red X**: Embedding of the original query
- **Green Circles**: Embeddings of the retrieved text chunks

This visualization clearly shows the impact of query expansion on the retrieval results.

## Usage Instructions

1. Install the necessary libraries and load environment variables:
   ```bash
   pip install pypdf openai python-dotenv langchain chromadb umap-learn matplotlib
